set -g @plugin 'tmux-plugins/tmux-sensible'

# set -g default-terminal "tmux-256color" # handled by tmux-sensible
set -ag terminal-overrides ",xterm-256color:RGB"

set -g mouse on
set -g base-index 1              # start indexing windows at 1 instead of 0
set -g detach-on-destroy off     # don't exit from tmux when closing a session
# set -g escape-time 0             # zero-out escape time delay # handled by tmux-sensible
set -g history-limit 1000000     # increase history size (from 2,000)
set -g renumber-windows on       # renumber all windows when any window is closed
set -g set-clipboard on          # use system clipboard
set -g status-position bottom       # macOS / darwin style
set -g default-terminal "${TERM}"
setw -g mode-keys vi


# Define a function to toggle pane-border-status based on the pane count
set -g @toggle_pane_border 'if [ $(tmux list-panes | wc -l) -gt 1 ]; then tmux set -w pane-border-status bottom; else tmux set -w pane-border-status off; fi'

set -g @fzf-url-fzf-options '-p 60%,30% --prompt="ï‚Ž   " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

unbind C-b
set -g prefix C-a
bind-key C-a send-prefix

unbind %
bind \\ split-window -h

unbind '"'
bind - split-window -v

unbind R
bind R source-file ~/.config/tmux/tmux.conf

unbind P
bind P run-shell "#{@toggle_pane_border}"

bind-key -n -r C-Up resize-pane -U 5
bind-key -n -r C-Down resize-pane -D 5
bind-key -n -r C-Left resize-pane -L 5
bind-key -n -r C-Right resize-pane -R 5

# bind -r m resize-pane -Z

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind-key -T copy-mode-vi 'v' send -X begin-selection # start selecting text with "v"
bind-key -T copy-mode-vi 'y' send -X copy-selection # copy text with "y"

unbind -T copy-mode-vi MouseDragEnd1Pane # don't exit copy mode when dragging with mouse

# rename pane https://stackoverflow.com/a/73050709/1052725
bind < command-prompt -p "New Title: " -I "#{pane_title}" "select-pane -T '%%'"

# tpm plugin
set -g @plugin 'tmux-plugins/tpm'

# list of tmux plugins
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect' # persist tmux sessions after computer restart
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @plugin 'omerxx/tmux-sessionx'
# set -g @plugin 'catppuccin/tmux#v2.0.0'


# Disable automatic renaming of windows
# set -g allow-rename off
# set -g automatic-rename off
# setw -g automatic-rename off

set -g @sessionx-bind-zo-new-window 'ctrl-y'
set -g @sessionx-auto-accept 'off'
set -g @sessionx-bind 'o'
set -g @sessionx-x-path '~/dotfiles'
set -g @sessionx-window-height '85%'
set -g @sessionx-window-width '75%'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-custom-paths-subdirectories 'false'
set -g @sessionx-filter-current 'false'
set -g @continuum-restore 'on'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'

# catppuccin theme
set -g @catppuccin_flavour 'cyberdream' # cyberdream.theme file needs to be in ~/.config/tmux/plugins/tmux/themes
# set -g @catppuccin_window_left_separator "î‚¶"
# set -g @catppuccin_window_right_separator "î‚´Â "
# set -g @catppuccin_window_middle_separator " â–ˆ"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text " #{window_name}"
set -g @catppuccin_window_status "icon"
set -g @catppuccin_window_current_fill "all"
set -g @catppuccin_window_current_text "#{window_name}#{?window_zoomed_flag,(î®),}"

# set -g status-left ''
# set -g status-right-length 100

# Load catppuccin
# run ~/.config/tmux/plugins/tmux/catppuccin.tmux

# set -agF status-right '#{@catppuccin_status_session}'

# # Make the status line pretty and add some modules
# set -g @catppuccin_status_modules_right "directory date_time"
# set -g @catppuccin_status_modules_right ""
# set -g @catppuccin_status_modules_left "session"
# set -g @catppuccin_status_left_separator  " î‚¶"
# set -g @catppuccin_status_right_separator "î‚´ "
# set -g @catppuccin_status_right_separator_inverse "no"
# set -g @catppuccin_status_fill "icon"
# set -g @catppuccin_status_connect_separator "no"
# set -g @catppuccin_directory_text "#{b:pane_current_path}"
# set -g @catppuccin_date_time_text "%H:%M"

# Style

set -g status-style bg=black
# set -g status-style bg=default
# set -g status-right '#{session_name} #[fg=yellow]#{?window_zoomed_flag,î®,}#[fg=yellow]#{?window_zoomed_flag,ï‹,} #[fg=yellow]#{?window_zoomed_flag,ï‹,}'
set -g status-left ''
set -g status-right ' #{session_name} (#{session_windows}) '
set -g window-status-format '#[bg=default,fg=white dim] #{window_index}: #{window_name}#{?window_zoomed_flag,î®,}#{?window_last_flag, ðŸ’”,}'
set -g window-status-current-format '#[bg=default,fg=cyan bold bright] #{window_index}: #{window_name} [#{pane_title}] #{?window_zoomed_flag,ðŸ”,}ðŸ‘€'
set -g pane-active-border-style 'fg=magenta,bg=default'
set -g pane-border-style 'fg=brightblack,bg=default'
set -g pane-border-status off
set -g pane-border-format '#[fg=magenta italics, bg=default] #{pane_index} #{pane_title} '
# Only show pane titles if there are more than one
# Trigger after splitting a pane
set-hook -g after-split-window "run-shell \"#{@toggle_pane_border}\""
# set-hook -g after-split-window "run-shell 'tmux if-shell \"[ \$(tmux list-panes | wc -l) -gt 1 ]\" \"set -g pane-border-status bottom\" \"set -g pane-border-status off\"'"
# Trigger after killing a pane
set-hook -g after-kill-pane "run-shell \"#{@toggle_pane_border}\""
# set-hook -g after-kill-pane "run-shell 'tmux if-shell \"[ \$(tmux list-panes | wc -l) -gt 1 ]\" \"set -g pane-border-status bottom\" \"set -g pane-border-status off\"'"

set -g @plugin 'tmux-plugins/tmux-continuum' # automatically saves sessions for you every 15 minutes; keep last

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'
